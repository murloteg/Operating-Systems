# Задачи на синхронизацию. Блок #1

## 2.1 Проблема конкурентного доступа к разделяемому ресурсу.

- a. В каталоге sync репозитория git@github.com:mrutman/os.git вы найдете простую реализацию очереди на списке.<br>
Изучите код, соберите и запустите программу queue-example.c.<br>
Посмотрите вывод программы и убедитесь что он соответствует вашему пониманию работы данной реализации очереди.<br>
Добавьте реализацию функции queue_destroy().
- b. Изучите код программы queue-threads.c и разберитесь что она делает. Соберите программу.
  - i. Запустите программу несколько раз. Если появляются ошибки выполнения, попытайтесь их объяснить и определить что именно вызывает ошибку.<br>
        Какие именно ошибки вы наблюдали?
  - ii. Поиграйте следующими параметрами:<br>
        1. размером очереди (задается в queue_init()). Запустите программу с размером очереди от 1000 до 1000000.<br>
        2. привязкой к процессору (задается функцией set_cpu()). Привяжите потоки к одному процессору (ядру) и к разным.<br>
        3. планированием потоков (функция sched_yield()). Попробуйте убрать эту функцию перед созданием второго потока.<br>
        4. Объясните наблюдаемые результаты.<br>

## 2.2. Синхронизация доступа к разделяемому ресурсу
- a. Измените реализацию очереди, добавив спинлок для синхронизации доступа к
   разделяемым данным. 
- b. Убедитесь, что не возникает ошибок передачи данных через очередь. 
- c. Поиграйте параметрами из пункта 2.1:
   - i. Оцените загрузку процессора.
   - ii. Оцените время проведенное в пользовательском режиме и в режиме
   ядра.
   - iii. Оцените текущую заполненность очереди, количество попыток
   чтения-записи и количество прочитанных-записанных данных.
   - iv. Объясните наблюдаемые результаты. 
- d. Часто бывает, что поток пишущий данные в очередь вынужден ожидать их (например, из сети на select()/poll()).<br>
   Проэмулируйте эту ситуацию, добавив в поточную функцию писателя периодический вызов usleep(1). Выполните задания из пункта с.
- e. Измените реализацию очереди, заменив спинлок на мутекс. Проделайте задания из пунктов b, c и d. Сравните со спинлоком.
- f. Измените реализацию очереди, добавив условную переменную. Проделайте задания из пунктов b, c и d. Сравните со спинлоком и мутексом.
- g. Используйте для синхронизации доступа к очереди семафоры. Проделайте задания из пунктов b, c и d. Сравните со спинлоком, мутексом и условной переменной.
